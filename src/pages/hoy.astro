---
import Base from '../layouts/Base.astro';
import { getTodayOrLatest } from '../lib/trends';

const payload = getTodayOrLatest();
const items = payload?.data?.items ?? [];
const fecha = payload?.dateLabel ?? '';
---

<Base title="Tendencias" description="Tendencias de hoy">
  <section class="wrap">
    <h1>Tendencias de hoy</h1>
    {items.length === 0 ? (
      <p>No hay datos para hoy todavía.</p>
    ) : (
      <>
        {fecha && <p class="sub">Mostrando: {fecha}</p>}
        <div class="grid">
          {items.map((item) => (
            <article class="card">
              <a href={`/producto/${item.slug}`} class="thumb" aria-label={item.title}>
                <img
                  src={item.hero || '/placeholder.jpg'}
                  alt={item.title}
                  loading="lazy"
                  decoding="async"
                />
              </a>
              <div class="body">
                <a href={`/producto/${item.slug}`} class="title">{item.title}</a>
                <div class="meta">
                  <span class="badge">{item.niche}</span>
                  {typeof item.score === 'number' && <span class="score">· score {item.score}</span>}
                </div>
                <a href={`/producto/${item.slug}`} class="btn">Ver detalles</a>
              </div>
            </article>
          ))}
        </div>
      </>
    )}
  </section>

  <style>
    .wrap { max-width: 1150px; margin: 0 auto; padding: 2rem 1rem; }
    h1 { font-size: 2.25rem; margin: 0 0 0.5rem; }
    .sub { opacity: .8; margin-bottom: 1rem; }
    .grid { display: grid; grid-template-columns: repeat(auto-fill,minmax(290px,1fr)); gap: 1rem; }
    .card { background: var(--card); border: 1px solid var(--card-border); border-radius: 14px; overflow: hidden; display: flex; flex-direction: column; }
    .thumb { display:block; aspect-ratio: 16/9; background: #0b0e11; }
    .thumb img { width:100%; height:100%; object-fit: cover; }
    .body { padding: .9rem; display:flex; gap:.6rem; flex-direction:column; }
    .title { font-weight: 700; line-height:1.2; text-decoration:none; color: var(--fg); }
    .title:hover { text-decoration: underline; }
    .meta { font-size:.9rem; opacity:.85; display:flex; align-items:center; gap:.5rem; }
    .badge { background: var(--badge); color: var(--badge-fg); border-radius: 999px; padding: .15rem .55rem; font-size: .8rem; }
    .btn { align-self: flex-start; border: 1px solid var(--card-border); padding:.45rem .7rem; border-radius: 10px; text-decoration:none; }
    .btn:hover { background: var(--hover); }
  </style>
</Base>
