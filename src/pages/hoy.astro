---
import Base from "../layouts/Base.astro";

// Cargamos TODOS los índices generados y nos quedamos con el más reciente
const allIndex = Object.values(
  import.meta.glob("/src/data/trends/**/index.json", { eager: true, import: "default" })
) as Array<{date:string, items:Array<{slug:string,title:string,niche:string,score:number,hero?:string}>}>;

const latest = [...allIndex].sort((a,b)=> (b?.date||"").localeCompare(a?.date||""))[0];
const items = latest?.items ?? [];
---

<Base title="Tendencias de hoy · Teknovashop">
  <h1>Tendencias de hoy</h1>

  {items.length === 0 ? (
    <p>No hay datos para hoy todavía.</p>
  ) : (
    <section class="grid">
      {items.map((it) => (
        <article class="card">
          <a class="media" href={`/producto/${it.slug}`} aria-label={`Ver detalles de ${it.title}`}>
            <img
              src={it.hero && it.hero !== "/placeholder.jpg" ? it.hero : "/placeholder.jpg"}
              alt={it.title}
              loading="lazy"
              decoding="async"
            />
            <span class="shade"></span>
            <span class="niche">{it.niche}</span>
          </a>
          <div class="body">
            <h3 class="title">
              <a href={`/producto/${it.slug}`}>{it.title}</a>
            </h3>
            <p class="meta">
              <span class="badge">score {String(it.score ?? 0)}</span>
            </p>
            <a class="btn" href={`/producto/${it.slug}`}>Ver detalles</a>
          </div>
        </article>
      ))}
    </section>
  )}

  <style>
    .grid{
      display:grid; gap: 1.25rem;
      grid-template-columns: repeat(auto-fill, minmax(270px, 1fr));
      margin-top: 1rem;
    }
    .card{
      background: var(--card);
      border: 1px solid var(--muted);
      border-radius: 16px;
      overflow: hidden;
      box-shadow: 0 10px 30px rgba(0,0,0,.25);
      display:flex; flex-direction:column;
    }
    .media{
      position:relative; display:block; height: 200px;
      background:#0d1319; overflow:hidden;
    }
    .media img{ width:100%; height:100%; object-fit: cover; display:block; transform: scale(1.02); }
    .shade{
      position:absolute; inset:0;
      background: linear-gradient(180deg, rgba(0,0,0,0) 45%, rgba(0,0,0,.45) 100%);
    }
    .niche{
      position:absolute; left:10px; bottom:10px;
      background: rgba(0,196,199,.18);
      border: 1px solid rgba(0,196,199,.35);
      color:#bffbff; font-weight:700; font-size:.76rem;
      padding:.25rem .5rem; border-radius:999px;
      backdrop-filter: blur(4px);
    }
    .body{ padding: 1rem; }
    .title{ margin: 0 0 .25rem; font-size:1.05rem; }
    .title a{ color: var(--text); text-decoration:none; }
    .title a:hover{ color: var(--brand); }
    .meta{ margin:.25rem 0 .6rem; color:#9fb3b8; font-size:.9rem; }
    .badge{
      display:inline-block; padding:.15rem .45rem; border-radius:8px;
      background: rgba(255,255,255,.06); border: 1px solid var(--muted);
    }
    .btn{
      display:inline-block; padding:.6rem .85rem;
      background: var(--brand); color:#00292b; font-weight:800; letter-spacing:.2px;
      border-radius:10px; text-decoration:none;
    }
    .btn:hover{ filter:brightness(.95); }
  </style>
</Base>
