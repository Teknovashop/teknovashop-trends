---
import Base from "@/layouts/Base.astro";

// Carga todos los índices de productos y escoje el más reciente por ruta
const all = import.meta.glob("../data/trends/**/index.json", { eager: true }) as Record<string, any>;
const keys = Object.keys(all).sort().reverse(); // la ruta YYYY/MM/DD ordena bien
const latest = keys[0] ? (all[keys[0]] as any).default || all[keys[0]] : { items: [] };
const items = latest.items || [];
---

<Base title="Tendencias de hoy · Productos" description="Selección curada en español de productos en tendencia.">
  <h1>Tendencias de hoy</h1>
  <p class="sub">Selección curada en español. Clic en cada tarjeta para ver mini-review y enlaces de comparación.</p>

  {items.length === 0 ? (
    <p>No hay tendencias generadas hoy todavía.</p>
  ) : (
    <div class="grid">
      {items.map((it:any) => (
        <a class="card" href={`/producto/${it.slug}/`}>
          <img src={it.hero || '/placeholder.jpg'} alt={it.title} loading="lazy" />
          <div class="cat">{it.niche || 'tecnologia'}</div>
          <h3>{it.title}</h3>
          <small class="muted">score {it.score || 1}</small>
        </a>
      ))}
    </div>
  )}

  <style>
    .sub{ color:#475569; margin:.25rem 0 1rem }
    .grid{ display:grid; gap:16px; grid-template-columns: repeat(auto-fill,minmax(260px,1fr)); }
    .card{ display:block; background:#fff; border:1px solid #e5e7eb; border-radius:14px; overflow:hidden; text-decoration:none; color:#0f172a; }
    .card img{ width:100%; height:160px; object-fit:cover; display:block }
    .cat{ margin:.6rem .75rem 0; display:inline-block; background:#e6f7f7; color:#0a5557; padding:.25rem .5rem; border-radius:12px; font-size:.8rem; font-weight:700 }
    .card h3{ margin:.4rem .75rem .3rem; font-size:1rem; line-height:1.2 }
    .muted{ margin:0 .75rem 1rem; color:#64748b }
  </style>
</Base>
