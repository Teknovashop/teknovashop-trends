---
import Base from '../layouts/Base.astro';
import fs from 'fs';
import path from 'path';

const today = new Date();
const yyyy = String(today.getFullYear());
const mm = String(today.getMonth()+1).padStart(2,'0');
const dd = String(today.getDate()).padStart(2,'0');

let payload = { date: `${yyyy}-${mm}-${dd}`, items: [] };

try {
  const p = path.join(Astro.root, 'src', 'data', 'trends', yyyy, mm, dd, 'index.json');
  payload = JSON.parse(fs.readFileSync(p, 'utf-8'));
} catch {}

const items = payload.items || [];
---

<Base title="Tendencias de hoy — Teknovashop">
  <h1>Tendencias de hoy</h1>

  {items.length === 0 ? (
    <p>No hay datos para hoy todavía.</p>
  ) : (
    <div class="grid">
      {items.map((p) => (
        <article class="card">
          <a href={`/producto/${p.slug}`}>
            <img
              class="hero"
              src={p.hero || '/placeholder.jpg'}
              alt={p.title}
              loading="lazy"
              onerror={`this.onerror=null;this.src='/placeholder.jpg';`}
            />
          </a>
          <div class="body">
            <h3><a href={`/producto/${p.slug}`}>{p.title}</a></h3>
            <p class="small">
              <span class="badge">{p.niche}</span> · score {p.score}
            </p>
            <a class="btn" href={`/producto/${p.slug}`}>Ver detalles</a>
          </div>
        </article>
      ))}
    </div>
  )}
</Base>

<style>
.grid{
  display:grid;
  gap:1.25rem;
  grid-template-columns: repeat(auto-fill, minmax(290px,1fr));
}
.card{
  border:1px solid var(--muted);
  border-radius:16px;
  overflow:hidden;
  background: var(--panel);
  box-shadow: 0 4px 20px rgba(0,0,0,.06);
}
.hero{
  width:100%;
  aspect-ratio:16/9;
  object-fit:cover;
  background:#f3f5f7;
}
.body{ padding:1rem; }
.badge{
  display:inline-block;
  font-size:.75rem;
  padding:.2rem .5rem;
  color:#155;
  background:#e6fffc;
  border-radius:999px;
}
.small{ color:#5e6; font-size:.85rem; }
.btn{
  display:inline-block;
  margin-top:.6rem;
  padding:.5rem .75rem;
  border-radius:10px;
  background:#0aa;
  color:white;
  text-decoration:none;
}
.btn:hover{ filter:brightness(.95); }
</style>
