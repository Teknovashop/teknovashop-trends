---
import Base from '../../layouts/Base.astro';
import { gatherAllItems, getItemBySlug } from '../../lib/trends';

export async function getStaticPaths() {
  // Generamos TODAS las rutas a partir de los JSON
  const items = gatherAllItems();
  return items.map((it) => ({ params: { slug: it.slug } }));
}

const { slug } = Astro.params;
const item = slug ? getItemBySlug(slug) : null;

if (!item) {
  throw new Error('Producto no encontrado');
}
---

<Base title={item.title} description={`Ficha de ${item.title}`}>
  <section class="wrap">
    <h1>{item.title}</h1>

    <figure class="hero">
      <img src={item.hero || '/placeholder.jpg'} alt={item.title} loading="eager" />
    </figure>

    <p class="meta">
      <span class="badge">{item.niche}</span>
      {typeof item.score === 'number' && <span>· score {item.score}</span>}
      {item.date && <span>· {item.date}</span>}
    </p>

    <div class="content">
      <p><strong>Resumen:</strong> tendencia del día.</p>
      <p><strong>Pros:</strong> buena relación calidad/precio. <strong>Contras:</strong> depende del caso.</p>

      <h3>Dónde comparar precios</h3>
      <ul>
        <li><a href={`https://www.amazon.es/s?k=${encodeURIComponent(item.title)}&tag=teknovashop-21&language=es_ES`} target="_blank" rel="nofollow noopener">Amazon (ES)</a></li>
        <li><a href={`https://es.aliexpress.com/wholesale?SearchText=${encodeURIComponent(item.title)}`} target="_blank" rel="nofollow noopener">AliExpress</a></li>
        <li><a href={`https://es.shein.com/pdsearch/${encodeURIComponent(item.title)}/`} target="_blank" rel="nofollow noopener">SHEIN</a></li>
      </ul>
    </div>
  </section>

  <style>
    .wrap { max-width: 900px; margin: 0 auto; padding: 2rem 1rem; }
    h1 { font-size: 2rem; margin-bottom: .75rem; }
    .hero { margin: 0 0 1rem; border: 1px solid var(--card-border); border-radius: 12px; overflow: hidden; }
    .hero img { width:100%; height:auto; display:block; }
    .meta { opacity:.85; margin-bottom: 1rem; display:flex; gap:.5rem; align-items:center; }
    .badge { background: var(--badge); color: var(--badge-fg); border-radius: 999px; padding: .15rem .55rem; font-size: .85rem; }
    .content h3 { margin-top: 1.25rem; }
  </style>
</Base>
