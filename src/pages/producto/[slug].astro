---
import Base from '../../layouts/Base.astro';

/**
 * Genera todas las rutas estáticas leyendo los MD de:
 *   src/content/trends/YYYY/MM/DD/*.md
 * OJO: la ruta es relativa a este archivo (src/pages/producto/[slug].astro)
 */
export async function getStaticPaths() {
  // Hacemos el glob *dentro* de la función para evitar problemas de ámbito
  const modules = import.meta.glob('../../content/trends/**/*.md', { eager: true });

  const paths = [];
  for (const mod of Object.values(modules)) {
    // Cada módulo tiene .frontmatter y .default (componente de contenido)
    const front = (mod as any)?.frontmatter ?? {};
    const Content = (mod as any)?.default;

    if (front?.slug && Content) {
      paths.push({
        params: { slug: front.slug },
        props: { frontmatter: front, Content },
      });
    }
  }

  return paths;
}

const { frontmatter, Content } = Astro.props;
const { title, niche, score, hero } = frontmatter;

export const prerender = true;
---

<Base title={title}>
  <style>
    .hero-wrap {
      max-width: 1100px;
      margin: 0 auto 1rem;
      border-radius: 14px;
      overflow: hidden;
      background: #0e141a;
      border: 1px solid rgba(255,255,255,.08);
    }
    .hero {
      display: block;
      width: 100%;
      aspect-ratio: 16/9;
      object-fit: cover;
    }
    .content {
      max-width: 1100px;
      margin: 0 auto;
      font-size: 1.03rem;
    }
    .meta {
      display: flex;
      gap: .6rem;
      align-items: center;
      margin: .35rem 0 1rem;
      color: #b9c5cb;
      font-size: .95rem;
    }
    .badge {
      display:inline-block; padding:.15rem .5rem; border-radius:999px;
      background: rgba(0,196,199,.15); color:#93f7f9; font-weight:600;
    }
    .content h1 { margin: .2rem 0 0.8rem; line-height: 1.15; }
    .content h2, .content h3 { margin-top: 1.2rem; }
    .content ul { padding-left: 1.2rem; }
  </style>

  <div class="hero-wrap">
    <img class="hero" src={hero || '/placeholder.jpg'} alt={title} loading="eager" decoding="async" />
  </div>

  <div class="content">
    <h1>{title}</h1>

    <div class="meta">
      <span class="badge">{niche}</span>
      <span>· score {score}</span>
    </div>

    <article>
      <Content />
    </article>
  </div>
</Base>
